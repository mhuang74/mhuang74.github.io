<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  <link href='&#x2F;icons&#x2F;site.webmanifest' rel="manifest" />
  
  
  <link color="#5bbad5" href='&#x2F;icons&#x2F;safari-pinned-tab.svg' rel="mask-icon" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;apple-touch-icon.png' rel="apple-touch-icon" sizes="180x180" />
  

  

  

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.1/css/academicons.min.css" integrity="sha384-FIue+PI4SsI9XfHCz8dBLg33b0c1fMJgNU3X//L26FYbGnlSEfWmNT7zgWc2N9b6" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css" integrity="sha384-IJLmUY0f1ePPX6uSCJ9Bxik64/meJmjSYD7dHaJqTXXEBE4y+Oe9P2KBZa/z7p0Q" crossorigin="anonymous">
  <link href="https://michaelhuang.xyz/deep-thought.css" rel="stylesheet" />
  

<script src="https://cdn.jsdelivr.net/npm/vega@5.21.0" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.2" crossorigin="anonymous"></script>



  <title>
    
mhuang74&#x27;s blog | Visualize NYC 311 Call Stats via Zola

  </title>

  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3VYKYSGLFF"></script>
  <script type="text/javascript">
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "G-3VYKYSGLFF");
  </script>
  
  

  
</head>

<body class="has-background-white">
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item is-size-5 has-text-weight-bold" href="https:&#x2F;&#x2F;michaelhuang.xyz">mhuang74&#x27;s blog</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;michaelhuang.xyz&#x2F;">
            Home
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;michaelhuang.xyz&#x2F;posts">
            Posts
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;michaelhuang.xyz&#x2F;tags">
            Tags
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;michaelhuang.xyz&#x2F;categories">
            Categories
          </a>
          
          
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  
  

  
<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article class="box">
          <h1 class="title">
            Visualize NYC 311 Call Stats via Zola
          </h1>
          <p class="subtitle">Play with chart.xkcd and vega-lite</p>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="far fa-calendar-alt"></i>
  </span>
  <span><time datetime="2022-04-09">April 09, 2022</time></span>
</span>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="far fa-clock"></i>
  </span>
  <span>9 min,</span>
  <span class="icon">
    <i class="fas fa-pencil-alt"></i>
  </span>
  <span>1680 words</span>
</span>

            </div>
            <div class="column">
              
              
<p>
  Categories:
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://michaelhuang.xyz/categories/technical/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-cube"></i>
      </span>
      <span>Technical</span>
    </span>
  </a>
  
</p>

              
            </div>
            <div class="column has-text-right-desktop">
              
              
<p>
  Tags:
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://michaelhuang.xyz/tags/chart/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>chart</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://michaelhuang.xyz/tags/open-data/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>open data</span>
    </span>
  </a>
  
  <a class="has-text-info-dark has-text-weight-semibold" href="https://michaelhuang.xyz/tags/zola/">
    <span class="icon-text">
      <span class="icon">
        <i class="fas fa-tag"></i>
      </span>
      <span>zola</span>
    </span>
  </a>
  
</p>

              
            </div>
          </div>
          <div class="content mt-2">
            <p>I want to explore rendering charts via static site generators. Here are a couple of libraries that are easy to integrate with <a rel="noopener nofollow noreferrer" target="_blank" href="https://www.getzola.org/">Zola</a>.</p>
<p>In this post, I plot open data from NYC 311 call records using:</p>
<ul>
<li>
<p><a rel="noopener nofollow noreferrer" target="_blank" href="https://timqian.com/chart.xkcd/">chart.xkcd</a> - a chart library that plots “sketchy”, “cartoony” or “hand-drawn” styled charts.</p>
</li>
<li>
<p><a rel="noopener nofollow noreferrer" target="_blank" href="https://vega.github.io/vega-lite/">vega-lite</a> - a high-level grammar of interactive graphics.</p>
</li>
</ul>
<p>Raw data is available <a href="/data.csv">here</a>, or viewed interactively via my test post on <a href="https://michaelhuang.xyz/posts/test-table/">DataTables</a>.</p>
<p>Here's a peek at raw csv data.</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">Unique Key,Created Date,Closed Date,Agency,Agency Name,Complaint Type,Descriptor,Location Type,Incident Zip,Incident Address,Street Name,Cross Street 1,Cross Street 2,Intersection Street 1,Intersection Street 2,Address Type,City,Landmark,Facility Type,Status,Due Date,Resolution Description,Resolution Action Updated Date,Community Board,BBL,Borough,X Coordinate (State Plane),Y Coordinate (State Plane),Open Data Channel Type,Park Facility Name,Park Borough,Vehicle Type,Taxi Company Borough,Taxi Pick Up Location,Bridge Highway Name,Bridge Highway Direction,Road Ramp,Bridge Highway Segment,Latitude,Longitude,Location
</span><span style="color:#abb2bf;">42254749,04/18/2019 09:55:45 PM,04/19/2019 03:45:24 AM,NYPD,New York City Police Department,Noise - Residential,Banging/Pounding,Residential Building/House,11235,3855 SHORE PARKWAY,SHORE PARKWAY,BRAGG STREET,BELT PARKWAY WB KNAPP STREET EN,,,ADDRESS,BROOKLYN,,Precinct,Closed,04/19/2019 05:55:45 AM,The Police Department responded to the complaint and with the information available observed no evidence of the violation at that time.,04/19/2019 03:45:24 AM,15 BROOKLYN,3088060140,BROOKLYN,1002973,152924,PHONE,Unspecified,BROOKLYN,,,,,,,,40.5863974,-73.9325913,&quot;(40.5863974, -73.9325913)&quot;
</span><span style="color:#abb2bf;">16561258,05/01/2010 09:59:44 AM,05/01/2010 10:24:07 AM,NYPD,New York City Police Department,Traffic/Illegal Parking,Posted Parking Sign Violation,Street/Sidewalk,10019,WEST 55 STREET,WEST 55 STREET,9 AVENUE,10 AVENUE,,,BLOCKFACE,NEW YORK,,Precinct,Closed,05/01/2010 05:59:44 PM,The Police Department responded and upon arrival those responsible for the condition were gone.,05/01/2010 10:24:07 AM,04 MANHATTAN,,MANHATTAN,987551,218794,PHONE,Unspecified,MANHATTAN,,,,,,,,40.7672147,-73.9880831,&quot;(40.7672147, -73.9880831)&quot;
</span><span style="color:#abb2bf;">46412656,05/21/2020 06:15:38 PM,05/21/2020 06:33:51 PM,NYPD,New York City Police Department,Non-Emergency Police Matter,Face Covering Violation,Store/Commercial,11205,241 TAAFFE PLACE,TAAFFE PLACE,WILLOUGHBY AVENUE,DEKALB AVENUE,WILLOUGHBY AVENUE,DEKALB AVENUE,,BROOKLYN,TAAFFE PLACE,,Closed,,The Police Department responded to the complaint and took action to fix the condition.,05/21/2020 10:34:01 PM,03 BROOKLYN,3019250001,BROOKLYN,995466,191079,ONLINE,Unspecified,BROOKLYN,,,,,,,,40.69113738107441,-73.95955540938948,&quot;(40.69113738107441, -73.95955540938948)&quot;
</span><span style="color:#abb2bf;">40039013,08/17/2018 03:25:16 PM,08/20/2018 09:21:15 AM,HPD,Department of Housing Preservation and Development,PLUMBING,WATER SUPPLY,RESIDENTIAL BUILDING,10462,2132 WALLACE AVENUE,WALLACE AVENUE,,,,,ADDRESS,BRONX,,N/A,Closed,,The following complaint conditions are still open. HPD may attempt to contact you to verify the correction of the condition or may conduct an inspection.,08/20/2018 09:21:15 AM,11 BRONX,2042920024,BRONX,1021647,250439,PHONE,Unspecified,BRONX,,,,,,,,40.8539929,-73.8648172,&quot;(40.8539929, -73.8648172)&quot;
</span><span style="color:#abb2bf;">33913755,07/23/2016 10:09:54 AM,07/23/2016 03:10:37 PM,NYPD,New York City Police Department,Noise - Residential,Banging/Pounding,Residential Building/House,11367,79-25 150 STREET,150 STREET,79 AVENUE,UNION TURNPIKE,,,ADDRESS,FLUSHING,,Precinct,Closed,07/23/2016 06:09:54 PM,The Police Department reviewed your complaint and provided additional information below.,07/23/2016 03:10:37 PM,08 QUEENS,4067120001,QUEENS,1036022,201509,MOBILE,Unspecified,QUEENS,,,,,,,,40.7196209,-73.8132317,&quot;(40.7196209, -73.8132317)&quot;
</span><span style="color:#abb2bf;">18556060,08/25/2010 12:00:00 AM,09/12/2010 12:00:00 AM,HPD,Department of Housing Preservation and Development,PLUMBING,WATER-LEAKS,RESIDENTIAL BUILDING,11385,64-19 WOODBINE STREET,WOODBINE STREET,64 STREET,TRAFFIC AVENUE,,,ADDRESS,RIDGEWOOD,,N/A,Closed,,The Department of Housing Preservation and Development inspected the following conditions. Violations were issued. Information about specific violations is available at www.nyc.gov/hpd.,09/12/2010 12:00:00 AM,0 Unspecified,4036170055,Unspecified,1013387,197397,UNKNOWN,Unspecified,Unspecified,,,,,,,,,,
</span><span style="color:#abb2bf;">34961688,12/08/2016 03:45:20 PM,12/16/2016 07:55:09 AM,DOT,Department of Transportation,Broken Muni Meter,Timer Defect - Fast/Fail,Street,11217,64 7 AVENUE,7 AVENUE,LINCOLN PLACE,BERKELEY PLACE,,,ADDRESS,BROOKLYN,,N/A,Closed,12/28/2016 03:45:20 PM,&quot;The Department of Transportation inspected the condition you reported. You can find additional information in the &quot;&quot;Notes to Customer&quot;&quot; field.&quot;,12/16/2016 07:55:09 AM,06 BROOKLYN,3009517501,BROOKLYN,991255,185391,PHONE,Unspecified,BROOKLYN,,,,,,,,40.6755294,-73.9747461,&quot;(40.6755294, -73.9747461)&quot;
</span><span style="color:#abb2bf;">20227197,04/13/2011 09:34:46 AM,04/13/2011 10:05:57 AM,DPR,Department of Parks and Recreation,Root/Sewer/Sidewalk Condition,Sidewalk Consultation,Street,11375,63-61 YELLOWSTONE BOULEVARD,YELLOWSTONE BOULEVARD,63 DRIVE,64 AVENUE,,,ADDRESS,FOREST HILLS,,N/A,Closed,05/13/2011 09:58:26 AM,&quot;The agency has mailed literature to the customer concerning the Sidewalk Consultation, and is currently evaluating the request.&quot;,04/13/2011 10:05:57 AM,06 QUEENS,4021480001,QUEENS,1025253,206273,PHONE,Unspecified,QUEENS,,,,,,,,40.7327533,-73.8520519,&quot;(40.7327533, -73.8520519)&quot;
</span><span style="color:#abb2bf;">16296482,03/23/2010 07:20:41 PM,12/02/2013 12:00:00 AM,DOB,Department of Buildings,Special Projects Inspection Team (SPIT),Illegal Hotel Rooms In Residential Building,,11230,1305 EAST 19 STREET,EAST 19 STREET,AVENUE L,AVENUE M,,,ADDRESS,BROOKLYN,,N/A,Closed,,&quot;The Department of Buildings determined that the conditions described in this complaint were addressed under another service request number. Click on &quot;&quot;Learn More&quot;&quot; in the &quot;&quot;Did You Know&quot;&quot; section below for more information.&quot;,12/02/2013 12:00:00 AM,14 BROOKLYN,3067390001,BROOKLYN,996377,164759,UNKNOWN,Unspecified,BROOKLYN,,,,,,,,,,
</span></code></pre>
<span id="continue-reading"></span><h2 id="chart-xkcd"><a rel="noopener nofollow noreferrer" target="_blank" href="https://timqian.com/chart.xkcd/">chart.xkcd</a></h2>
<p><a rel="noopener nofollow noreferrer" target="_blank" href="https://timqian.com/chart.xkcd/">chart.xkcd</a> comes integrated with <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/RatanShreshtha/DeepThought">deep-thought</a> theme. It uses JSON to define axis and dataset, but does not come with any data loading APIs.</p>
<p>Since I don't want to write data wrangling code via javscript, I manually enter pre-aggregated complaint counts into JSON definition below.</p>
<p>Chart is generated via the <code>chart()</code> shortcode, which is defined in <code>themes/deep-thought/templates/shortcodes/chart.html</code>, and doesn't do much besides creating the the svg container and passing along the JSON definition.</p>
<p><strong>chart() short code</strong></p>
<pre data-lang="html" style="background-color:#2b303b;color:#6c7079;" class="language-html "><code class="language-html" data-lang="html"><span style="color:#abb2bf;">&lt;</span><span style="color:#eb6772;">svg </span><span style="color:#db9d63;">class</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;chart&quot;</span><span style="color:#abb2bf;">&gt;{{body | safe}}&lt;/</span><span style="color:#eb6772;">svg</span><span style="color:#abb2bf;">&gt;
</span></code></pre>
<p><strong>call chart() shortcode with JSON definition to generate chart</strong></p>
<ul>
<li>note: escaped <code>{%</code> and <code>%}</code> due to Zola rendering issues</li>
</ul>
<pre data-lang="json" style="background-color:#2b303b;color:#6c7079;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#abb2bf;">\{</span><span style="background-color:#e05252;color:#ffffff;">%</span><span style="color:#abb2bf;"> </span><span style="background-color:#e05252;color:#ffffff;">chart()</span><span style="color:#abb2bf;"> </span><span style="background-color:#e05252;color:#ffffff;">%\</span><span style="color:#abb2bf;">}
</span><span style="color:#abb2bf;">{
</span><span style="color:#abb2bf;">  </span><span style="color:#9acc76;">&quot;type&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Bar&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">  </span><span style="color:#9acc76;">&quot;title&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Top 10 NYC 311 Complaint Types&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">  </span><span style="color:#9acc76;">&quot;xLabel&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint Type&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">  </span><span style="color:#9acc76;">&quot;yLabel&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Count&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">  </span><span style="color:#9acc76;">&quot;data&quot;</span><span style="color:#abb2bf;">: {
</span><span style="color:#abb2bf;">    </span><span style="color:#9acc76;">&quot;labels&quot;</span><span style="color:#abb2bf;">: [</span><span style="color:#9acc76;">&quot;Noise - Residential&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Heat/Hot Water&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Illegal Parking&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Street Condition&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Blocked Driveway&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Street Light Condition&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Plumbing&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Heating&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Water System&quot;</span><span style="color:#abb2bf;">, </span><span style="color:#9acc76;">&quot;Nosie - Street/Sidewalk&quot;</span><span style="color:#abb2bf;">],
</span><span style="color:#abb2bf;">    </span><span style="color:#9acc76;">&quot;datasets&quot;</span><span style="color:#abb2bf;">: [
</span><span style="color:#abb2bf;">      {
</span><span style="color:#abb2bf;">        </span><span style="color:#9acc76;">&quot;data&quot;</span><span style="color:#abb2bf;">: [</span><span style="color:#db9d63;">162</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">129</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">91</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">86</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">85</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">71</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">70</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">70</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">63</span><span style="color:#abb2bf;">, </span><span style="color:#db9d63;">63</span><span style="color:#abb2bf;">]
</span><span style="color:#abb2bf;">      }
</span><span style="color:#abb2bf;">    ]
</span><span style="color:#abb2bf;">  }
</span><span style="color:#abb2bf;">}
</span><span style="color:#abb2bf;">\{</span><span style="background-color:#e05252;color:#ffffff;">%</span><span style="color:#abb2bf;"> </span><span style="background-color:#e05252;color:#ffffff;">end</span><span style="color:#abb2bf;"> </span><span style="background-color:#e05252;color:#ffffff;">%\</span><span style="color:#abb2bf;">}
</span></code></pre>
<p><strong>output</strong>
<svg class="chart">{
  "type": "Bar",
  "title": "Top 10 NYC 311 Complaint Types",
  "xLabel": "Complaint Type",
  "yLabel": "Count",
  "data": {
    "labels": ["Noise - Residential", "Heat/Hot Water", "Illegal Parking", "Street Condition", "Blocked Driveway", "Street Light Condition", "Plumbing", "Heating", "Water System", "Nosie - Street/Sidewalk"],
    "datasets": [
      {
        "data": [162, 129, 91, 86, 85, 71, 70, 70, 63, 63]
      }
    ]
  }
}</svg>
</p>
<p>Overall, chart.xkcd is simple to use, looks nice, and tooltip works out of the box.</p>
<h2 id="vega-lite"><a rel="noopener nofollow noreferrer" target="_blank" href="https://vega.github.io/vega-lite/">vega-lite</a></h2>
<p>It is fairly easy to integrate <a rel="noopener nofollow noreferrer" target="_blank" href="https://vega.github.io/vega-lite/">vega-lite</a> into Zola.</p>
<p>First, override theme base template <code>base.html</code> to include vega-related javascript libraries in header. Zola support overriding either at file or block level. I hijacked a predefined block in the header section called <code>user_custom_stylesheet</code> which works just fine for my purpose.</p>
<p><strong>templates/base.html</strong></p>
<pre data-lang="html" style="background-color:#2b303b;color:#6c7079;" class="language-html "><code class="language-html" data-lang="html"><span style="color:#abb2bf;">{% extends &quot;deep-thought/templates/base.html&quot; %}
</span><span style="color:#abb2bf;">
</span><span style="color:#abb2bf;">{% block user_custom_stylesheet %}
</span><span style="color:#abb2bf;">{% if config.extra.vega_chart.enabled %}
</span><span style="color:#abb2bf;">&lt;</span><span style="color:#eb6772;">script </span><span style="color:#db9d63;">src</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;https://cdn.jsdelivr.net/npm/vega@5.21.0&quot; </span><span style="color:#db9d63;">crossorigin</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;anonymous&quot;</span><span style="color:#abb2bf;">&gt;&lt;/</span><span style="color:#eb6772;">script</span><span style="color:#abb2bf;">&gt;
</span><span style="color:#abb2bf;">&lt;</span><span style="color:#eb6772;">script </span><span style="color:#db9d63;">src</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;https://cdn.jsdelivr.net/npm/vega-lite@5.2.0&quot; </span><span style="color:#db9d63;">crossorigin</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;anonymous&quot;</span><span style="color:#abb2bf;">&gt;&lt;/</span><span style="color:#eb6772;">script</span><span style="color:#abb2bf;">&gt;
</span><span style="color:#abb2bf;">&lt;</span><span style="color:#eb6772;">script </span><span style="color:#db9d63;">src</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;https://cdn.jsdelivr.net/npm/vega-embed@6.20.2&quot; </span><span style="color:#db9d63;">crossorigin</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;anonymous&quot;</span><span style="color:#abb2bf;">&gt;&lt;/</span><span style="color:#eb6772;">script</span><span style="color:#abb2bf;">&gt;
</span><span style="color:#abb2bf;">{% endif %}
</span><span style="color:#abb2bf;">{% endblock %}
</span></code></pre>
<p><code>vega_chart()</code> invokes custom shortcode defined in <code>templates/shortcodes/vega_chart.html</code>, which just creates a div container and passes along the javascript body. Chart is defined via vega-lite spec expressed in JSON format. Javascript code takes the JSON spec and calls <a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/vega/vega-embed">vega-embed</a> api to compile and render the view.</p>
<p><strong>vega_chart() shortcode</strong></p>
<pre data-lang="html" style="background-color:#2b303b;color:#6c7079;" class="language-html "><code class="language-html" data-lang="html"><span style="color:#abb2bf;">&lt;</span><span style="color:#eb6772;">div </span><span style="color:#db9d63;">id</span><span style="color:#abb2bf;">=</span><span style="color:#9acc76;">&quot;{{id}}&quot;</span><span style="color:#abb2bf;">&gt;&lt;/</span><span style="color:#eb6772;">div</span><span style="color:#abb2bf;">&gt;
</span><span style="color:#abb2bf;">&lt;</span><span style="color:#eb6772;">script</span><span style="color:#abb2bf;">&gt;{{</span><span style="color:#adb7c9;">body | safe</span><span style="color:#abb2bf;">}}&lt;/</span><span style="color:#eb6772;">script</span><span style="color:#abb2bf;">&gt;
</span></code></pre>
<p><strong>call vega_chart() shortcode with Javascript body to render chart</strong></p>
<ul>
<li>Note: vega-lite spec is expressed in JSON format</li>
</ul>
<pre data-lang="js" style="background-color:#2b303b;color:#6c7079;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#abb2bf;">\{</span><span style="color:#adb7c9;">% </span><span style="color:#5cb3fa;">vega_chart</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">id</span><span style="color:#adb7c9;">=</span><span style="color:#9acc76;">&quot;vis&quot;</span><span style="color:#abb2bf;">) </span><span style="color:#adb7c9;">%</span><span style="color:#abb2bf;">\}
</span><span style="color:#abb2bf;">
</span><span style="color:#abb2bf;">    </span><span style="font-style:italic;color:#5f697a;">// Assign the specification to a local variable vlSpec.
</span><span style="color:#abb2bf;">    </span><span style="color:#cd74e8;">var </span><span style="color:#eb6772;">vlSpec </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">{
</span><span style="color:#abb2bf;">        </span><span style="color:#9acc76;">&quot;$schema&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;https://vega.github.io/schema/vega-lite/v5.json&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">        </span><span style="color:#9acc76;">&quot;data&quot;</span><span style="color:#abb2bf;">: {</span><span style="color:#9acc76;">&quot;url&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;/data.csv&quot;</span><span style="color:#abb2bf;">},
</span><span style="color:#abb2bf;">        </span><span style="color:#9acc76;">&quot;transform&quot;</span><span style="color:#abb2bf;">: [
</span><span style="color:#abb2bf;">          {
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;aggregate&quot;</span><span style="color:#abb2bf;">: [{
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;op&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;count&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;field&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint Type&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;as&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint_Count&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">            }],
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;groupby&quot;</span><span style="color:#abb2bf;">: [</span><span style="color:#9acc76;">&quot;Complaint Type&quot;</span><span style="color:#abb2bf;">],
</span><span style="color:#abb2bf;">
</span><span style="color:#abb2bf;">          },
</span><span style="color:#abb2bf;">        ],
</span><span style="color:#abb2bf;">        </span><span style="color:#9acc76;">&quot;mark&quot;</span><span style="color:#abb2bf;">: {
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;type&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;bar&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;tooltip&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#db9d63;">true
</span><span style="color:#abb2bf;">        },
</span><span style="color:#abb2bf;">        </span><span style="color:#9acc76;">&quot;encoding&quot;</span><span style="color:#abb2bf;">: {
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;x&quot;</span><span style="color:#abb2bf;">: {
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;field&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint Type&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;type&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;ordinal&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;bin&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#db9d63;">false</span><span style="color:#abb2bf;">, 
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;sort&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;-y&quot;
</span><span style="color:#abb2bf;">            },
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;y&quot;</span><span style="color:#abb2bf;">: {
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;field&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint_Count&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;type&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;quantitative&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;sort&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;-y&quot;
</span><span style="color:#abb2bf;">            }
</span><span style="color:#abb2bf;">        }
</span><span style="color:#abb2bf;">    };
</span><span style="color:#abb2bf;">
</span><span style="color:#abb2bf;">
</span><span style="color:#abb2bf;">    </span><span style="font-style:italic;color:#5f697a;">// Embed the visualization in the container with id `vis`
</span><span style="color:#abb2bf;">    </span><span style="color:#5cb3fa;">vegaEmbed</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;#vis&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">vlSpec</span><span style="color:#abb2bf;">).</span><span style="color:#5ebfcc;">then</span><span style="color:#abb2bf;">(</span><span style="color:#cd74e8;">function</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">result</span><span style="color:#abb2bf;">) {
</span><span style="color:#abb2bf;">    </span><span style="font-style:italic;color:#5f697a;">// Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
</span><span style="color:#abb2bf;">    }).</span><span style="color:#5ebfcc;">catch</span><span style="color:#abb2bf;">(</span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">error</span><span style="color:#abb2bf;">);
</span><span style="color:#abb2bf;">
</span><span style="color:#abb2bf;">\{</span><span style="color:#adb7c9;">% </span><span style="color:#eb6772;">end </span><span style="color:#adb7c9;">%</span><span style="color:#abb2bf;">\}
</span></code></pre>
<div id="vis"></div>
<script>// Assign the specification to a local variable vlSpec.
    var vlSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": {"url": "/data.csv"},
        "transform": [
          {
            "aggregate": [{
                "op": "count",
                "field": "Complaint Type",
                "as": "Complaint_Count",
            }],
            "groupby": ["Complaint Type"],

          },
        ],
        "mark": {
            "type": "bar",
            "tooltip": true
        },
        "encoding": {
            "x": {
                "field": "Complaint Type",
                "type": "ordinal",
                "bin": false, 
                "sort": "-y"
            },
            "y": {
                "field": "Complaint_Count",
                "type": "quantitative",
                "sort": "-y"
            }
        }
    };

    // Embed the visualization in the container with id `vis`
    vegaEmbed('#vis', vlSpec).then(function(result) {
    // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
    }).catch(console.error);</script>
<p>vega-lite offers vastly more flexibility in terms of data aggregation, sorting, filtering, and rendering options, but it's also harder to debug. For example, I notice that the x-axis labels are rotated 90 degrees automatically for readability.</p>
<p>Here's an attempt to filter for top complaint counts (&gt; 50) by adding a <strong>filter</strong> step in <strong>transform</strong>.
Doesn't work. Looks like filter is being applied to csv data stream instead of output of aggregate.</p>
<pre data-lang="json" style="background-color:#2b303b;color:#6c7079;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#abb2bf;">        </span><span style="color:#9acc76;">&quot;transform&quot;</span><span style="color:#abb2bf;">: [
</span><span style="color:#abb2bf;">          {
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;aggregate&quot;</span><span style="color:#abb2bf;">: [{
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;op&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;count&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;field&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint Type&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;as&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint_Count&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">            }],
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;groupby&quot;</span><span style="color:#abb2bf;">: [</span><span style="color:#9acc76;">&quot;Complaint Type&quot;</span><span style="color:#abb2bf;">],
</span><span style="color:#abb2bf;">
</span><span style="color:#abb2bf;">          },
</span><span style="color:#abb2bf;">          {
</span><span style="color:#abb2bf;">            </span><span style="color:#9acc76;">&quot;filter&quot;</span><span style="color:#abb2bf;">: [{
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;field&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#9acc76;">&quot;Complaint_Count&quot;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">                </span><span style="color:#9acc76;">&quot;gt&quot;</span><span style="color:#abb2bf;">: </span><span style="color:#db9d63;">50
</span><span style="color:#abb2bf;">            }]
</span><span style="color:#abb2bf;">          }
</span><span style="color:#abb2bf;">        ],
</span><span style="color:#abb2bf;">
</span></code></pre>
<h3 id="summary">Summary</h3>
<p>I think both libraries have their usecases. I would use chart.xkcd to illustrate a point that only requires a few synthetic data points. Meanwhile, vega-lite's data aggregation, sorting, and filtering options makes it much more versatile for use with real datasets.</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Search</p>
      </header>
      <section class="modal-card-body">
        <div class="field mb-2">
          <div class="control">
            <input class="input" id="search" placeholder="Search this website." type="search" />
          </div>
        </div>
        <div class="search-results">
          <div class="search-results__items"></div>
        </div>
      </section>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


  

<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
          
          <div class="level-item has-text-centered">
            <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;michaelhuang.xyz&#x2F;posts&#x2F;google-asset-based-ad-extensions&#x2F;">
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Google Ads Asset-based Ad Extensions
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;michaelhuang.xyz&#x2F;posts&#x2F;qsv-lessons&#x2F;">
              What contributing to QSV taught me<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
            
        </nav>
      </div>
    </div>
  </div>
</section>



  



  <footer class="footer py-4">
    <div class="content has-text-centered">
      <p>
        Built with
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-code"></i>
          </span>
          <span>code</span>
        </span>
        and
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-heart"></i>
          </span>
          <span>love</span>
        </span>
      </p>
      <p>
        Powered by
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-power-off"></i>
          </span>
          <span>zola</span>
        </span>
      </p>
    </div>
  </footer>

  
  
  
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1.1.13/dist/chart.xkcd.min.js" integrity="sha384-xC3h1+IHXK8seA+8KfT79Z4e0GPsznjXBoMa5nd8ooWKplPyXx92NOmljWxLC/cs" crossorigin="anonymous"></script>
  
  
  <script src="https://michaelhuang.xyz/elasticlunr.min.js"></script>
  <script src="https://michaelhuang.xyz/search_index.en.js"></script><script src="https://michaelhuang.xyz/js/site.js"></script>

  





  
  
</body>

</html>
